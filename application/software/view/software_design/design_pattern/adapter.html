{include file="template/header" title="设计模式 适配器模式" /}
<p class="text-strong">适配器模式(Adapter), 将一个类的接口转换成客户希望的另外一个接口, 使得原本由于接口不兼容而不能一起工作的那些类可以一起工作.</p>
<img src="__ROOT__/static/image/design_pattern/adapter.png" />
<p class="text-strong">什么时候使用?</p>
<p>
    在软件开发中, 也就是系统的数据和行为都正确, 但接口不符时, 我们应该考虑用适配器, 目的是使控制范围之外的一个原有对象与某个接口匹配. 适配器模式主要应用于希望复用一些现存的类, 但是接口又与复用环境要求不一致的情况,
    比如在需要对早期代码复用一些功能等应用上很有实际价值.</p>
<p>
    其实使用适配器模式也是无奈之举, 颇有点"亡羊补牢"的感觉. 但是又没办法啊, 是软件就有维护的一天, 维护就有可能会因不同的开发人员, 不同的产品, 不同的厂家而造成功能类似但接口不同的情况, 此时就是适配器模式大展拳脚的时候了:<br>
    1) 一般在软件开发后期或维护期再考虑使用它. 如果是在设计阶段, 类似功能类的接口应该设计的一样.<br>
    2) 但是也有例外, 比如公司设计一系统时考虑使用第三方开发组件, 而这个组件的接口与我们自己的系统接口不相同的, 而我们也完全没有必要为了迎合它而改动自己的接口, 此时尽管是在开发的设计阶段,
    也是可以考虑用适配器模式来解决接口不同的问题.<br>
</p>
<p>
    如果能事先预防接口不同的问题, 不匹配问题就不会发生, 在有小的接口不统一问题发生时, 及时重构, 问题不至于扩大. 只有碰到无法改变原有设计和代码的情况下, 才考虑适配. 事后控制不如事中控制, 事中控制不如事前控制.
    适配器模式固然是好模式, 但如果无视它的应用场合而盲目使用, 其实是本末倒置了.
</p>
<p class="text-strong">在.NET中应用</p>
<p>
    .NET中有一个非常重要的适配器, 那就是DataAdapter. DataAdapter用作DataSet和数据源之间的适配器以便检索和保存数据.
    DataAdapter通过映射Fill(这更改了DataSet中的数据以便与数据源中的数据相匹配)和Update(这更改了数据源中的数据以便与DataSet中的数据相匹配)来提供这一适配器. 由于数据源可能是来自SQL
    Server, 可能来自Oracle, 也可能来自Access, DB2, 这些数据在组织上可能有不同之处, 但我们希望得到统一的DataSet(实质是XML数据), 此时用DataAdapter就是非常好的手段,
    我们不必关注不同数据库的数据细节, 就可以灵活的使用数据.
</p>
<div class="list list-square">
    <div class="title">代码范例 - 适配器模式</div>
    <div class="content closed">
		<pre class="prettyprint linenums">
<code>
using System;
using System.Collections.Generic;
using System.Text;

namespace 适配器模式
{
    class Program
    {
        static void Main(string[] args)
        {
            Target target = new Adapter();
            target.Request();

            Console.Read();
        }
    }

    class Target
    {
        public virtual void Request()
        {
            Console.WriteLine("普通請求!");
        }
    }

    class Adapter : Target
    {
        private Adaptee adaptee = new Adaptee();    // 建立一个私有的Adaptee对象


        public override void Request()              // 这样就可以把表面上调用Request()方法变成实际调用SpecificRequest()
        {
            adaptee.SpecificRequest();
        }
    }

    class Adaptee
    {
        public void SpecificRequest()
        {
            Console.WriteLine("特殊請求!");
        }
    }
}
</code>
		</pre>
    </div>

    <div class="title">代码范例 - 适配器模式 - 姚明打篮球</div>
    <div class="content closed">
		<pre class="prettyprint linenums">
<code>
using System;
using System.Collections.Generic;
using System.Text;

namespace 适配器模式
{
    class Program
    {
        static void Main(string[] args)
        {
            Player b = new Forwards("Battier"); 
            b.Attack();

            Player m = new Guards("McGrady");   
            m.Attack();

            Player ym = new Translator("姚明");  // 姚明打NBA
            ym.Attack();
            ym.Defense();

            Console.Read();
        }
    }

    // 球员
    abstract class Player
    {
        protected string name;

        public Player(string name)
        {
            this.name = name;
        }

        public abstract void Attack();
        public abstract void Defense();
    }

    // 外籍中锋
    class ChineseCenter
    {
        private string name;

        public string Name
        {
            get { return name; }
            set { name = value; }
        }

        public void 進攻()
        {
            Console.WriteLine("中鋒 {0} 進攻", name);
        }

        public void 防守()
        {
            Console.WriteLine("中鋒 {0} 防守", name);
        }
    }

    // 翻译
    class Translator : Player
    {
        private ChineseCenter zgzf = new ChineseCenter();

        public Translator(string name)
            : base(name)
        {
            zgzf.Name = name;
        }

        public override void Attack()
        {
            zgzf.進攻();
        }

        public override void Defense()
        {
            zgzf.防守();
        }
    }

    // 前锋
    class Forwards : Player
    {
        public Forwards(string name)
            : base(name)
        {
        }

        public override void Attack()
        {
            Console.WriteLine("Forwards {0} Attack", name);
        }

        public override void Defense()
        {
            Console.WriteLine("Forwards {0} Defense", name);
        }
    }

    // 中锋
    class Center : Player
    {
        public Center(string name)
            : base(name)
        {
        }

        public override void Attack()
        {
            Console.WriteLine("Center {0} Attack", name);
        }

        public override void Defense()
        {
            Console.WriteLine("Center {0} Defense", name);
        }
    }

    // 后位
    class Guards : Player
    {
        public Guards(string name)
            : base(name)
        {
        }

        public override void Attack()
        {
            Console.WriteLine("Guards {0} Attack", name);
        }

        public override void Defense()
        {
            Console.WriteLine("Guards {0} Defense", name);
        }
    }
}
</code>
		</pre>
    </div>
</div>

{include file="template/footer" /}