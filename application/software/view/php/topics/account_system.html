{include file="template/header" title="PHP 账号体系" /}

<div class="list list-number">
    <div class="title">加密口令</div>
    <div class="content closed">
		<p>MySQL提供了一个名为SHA()的函数, 它会对文本应用一个加密算法. 其结果是一个加密串, 长度固定为40个十六进制字符, 而不论原始口令的长度是多少.</p>
		<p>由于SHA()是一个MySQL函数而不是PHP函数, 所以调用这个函数时, 要作为在表中插入口令的查询的一部分. 例如, 以下代码向mismatch_user表插入一个新用户, 在这里应当使用SHA()加密口令.</p>
		<pre class="prettyprint linenums">
<code>
insert into mismatch_user(username, password, join_date) values('jnettles', SHA('tatlover'), now());
</code>
		</pre>

		<p>SHA()函数是一种单向加密, 无法还原. 这是为了确保加密数据的安全性, 即使有人攻击你的数据库, 并偷走所有口令, 他们也无法对其解密.</p>
		<p>要了解用户登录时是否正确地输入了口令, 你并不需要知道用户的原始口令. 这是因为, 只要提供同样的文本串, SHA()就会生产相同的40字符编码.</p>
		<pre class="prettyprint linenums">
<code>
select * from mismatch_user where password = SHA('tatlover')
</code>
		</pre>
    </div>

    <div class="title">使用HTTP认证</div>
    <div class="content closed">

    </div>

    <div class="title">使用cookie</div>
    <div class="content closed">
		<p>cookie数据由用户的浏览器存储在他们的计算机上, 而且cookie能够跨多个页面(脚本)持久保存, 甚至可以跨多个浏览器会话持久存储.</p>

		<p class="text-strong">设置cookie</p>
		<pre class="prettyprint linenums">
<code>
setcookie('username', 'sidneyk');                   // 默认浏览器关闭时, cookie将被删除
setcookie('username', 'sidneyk', time() + 3600);    // 1小时后, cookie将被自动删除
</code>
		</pre>

		<p class="text-storng">访问cookie</p>
		<pre class="prettyprint linenums">
<code>
$_COOKIE['username']
</code>
		</pre>

		<p class="text-strong">删除cookie</p>
		<pre class="prettyprint linenums">
<code>
setcookie('username', 'sidneyk', time() - 3600);    // 要删除一个cookie, 只需要将到期时间设置为过去的一个时间!
</code>
		</pre>
    </div>

    <div class="title">使用section</div>
    <div class="content closed">
		<p>就像cookie一样, session也可以存储信息, 只不过信息是存储在服务器上的, 而不是客户端.</p>
		<p>不同于cookie, session无法对一个session变量将数据存储多久做太多的控制, session往往在用户关闭浏览器时结束.</p>

		<p class="text-strong">开始会话</p>
		<pre class="prettyprint linenums">
<code>
session_start();
</code>
		</pre>

		<p class="text-strong">使用会话变量</p>
		<pre class="prettyprint linenums">
<code>
$_SESSION['username'] = 'sidneyk';    // 一旦使用session_start()开始了一个会话, 就可以使用会话变量.
</code>
		</pre>
		<p>
			禁用cookie的情况下要让会话正常工作, 还需要利用另外一个机制, 在不同页面之间传递会话ID. 这个机制需要将会话ID追加到每个页面的URL后面: <br>
			1) 如果服务器上php.ini文件中的session_use_trans_id被设置为1(true), 这就会自动发生. <br> 
			2) 如果你无法修改Web服务器上的这个文件, 必须手动向会话页面的URL追加会话ID: &lt;a href="viewprofile.php?&lt;?php echo SID; ?>">view your profile&lt;/a> <br>
		</p>

		<p class="text-strong">销毁会话</p>
		<pre class="prettyprint linenums">
<code>
// 浏览器关闭, 或者调用了session_destory()函数时, 会话就会结束.
session_destory();   
// session_destory()函数实际上并不会销毁会话变量, 销毁一个会话的所有会话变量, 有一种快速有效的方法: 即把$_SESSION设置为一个空数组!
$_SESSION = array();
// 如果浏览器支持cookie, 会话可能会设置一个cookie临时存储会话ID. 所以要通过PHP代码完全关闭一个会话, 还必须删除可能在浏览器上自动创建来存储会话ID的所有cookie.
if (isset($_COOKIE[session_name()])) setcookie(session_name(), '', time() - 3600);
</code>
		</pre>
    </div>
</div>

{include file="template/footer" /}