{include file="php/tp5/template/header" title="TP5 View" /}

<div class="list list-number">
    <div class="title">模板语言</div>
    <div class="content open">
        <div class="list list-number">
            <div class="title">模板变量</div>
            <div class="content closed">
                <p>(1) 先在控制器中定义模板变量</p>
                <pre class="prettyprint linenums">
<code>
&lt;?php
namespace app\index\controller;
use app\index\model\User as UserModel;
use think\Controller;

class User extends Controller // 继承了think\Controller类
{
    public function index()
    {
        $list = UserModel::all();
        // 给模板变量赋值
        $this->assign('list', $list); // 二维数组
        $this->assign('count', count($list)); // 标量
        // 渲染模板文件. 默认渲染输出的模板文件应该是当前控制器和操作对应的模板!
        return $this->fetch(); 
    }
}
</code>
				</pre>

                <p>(2) 然后在视图中使用模板变量</p>
                <pre class="prettyprint linenums">
<code>
&lt;h2>用户列表(｛$count｝)&lt;/h2>    // 标量类型
｛volist name="list" id="user"｝    // 二维数组类型
    &lt;div class="info">
        ID：｛$user.id｝&lt;br/>
        昵称：｛$user.nickname｝&lt;br/>
        邮箱：｛$user.email｝&lt;br/>
        生日：｛$user.birthday｝&lt;br/>
    &lt;/div>
｛/volist｝
</code>
				</pre>
            </div>

            <div class="title">运算符</div>
            <div class="content closed">
                <div class="content open">
                    <p>我们可以对模板输出使用运算符，包括对“+”“-” “*” “/”和“%”的支持。</p>
                    <div class="list list-number">
                        <div class="title">算术运算符</div>
                        <div class="content open">
                            <pre class="prettyprint linenums">
<code>
// +, -, *, /, %
&#123;$a + $b}
// ++, --
&#123;$a++}
&#123;++$a}
// 综合运算
&#123;$a + $b * 10}
</code>
							</pre>
                            <p>在使用运算符的时候，不再支持常规函数用法，例如：</p>
                            <pre class="prettyprint linenums">
<code>
&#123;$user.score+10} //正确的
&#123;$user['score']+10} //正确的
&#123;$user['score']*$user['level']} //正确的
&#123;$user['score']|myFun*10} //错误的
&#123;$user['score']+myFun($user['level'])} //正确的
</code>
							</pre>
                        </div>

                        <div class="title">?运算符</div>
                        <div class="content open">
                            <pre class="prettyprint linenums">
<code>
&#123;$status? '正常' : '错误'}
&#123;$info['status']? $info['msg'] : $info['error']}
&#123;$info.status? $info.msg : $info.error }
</code>
							</pre>
                        </div>

                        <div class="title">??运算符</div>
                        <div class="content open">
                            <pre class="prettyprint linenums">
<code>
&#123;$varname.aa ?? 'xxx'}
</code>
							</pre>
                        </div>

                        <div class="title">比较运算符</div>
                        <div class="content open">
                            <pre class="prettyprint linenums">
<code>
&#123;volist name="failures" id="failure"}
    &#123;if condition="$failure['id'] eq $current_failure_id"}
        &lt;option value="&#123;$failure.id}" selected>&#123;$failure.name}&lt;/option>
    &#123;else/}
        &lt;option value="&#123;$failure.id}">&#123;$failure.name}&lt;/option>
    &#123;/if}
&#123;/volist}
</code>
							</pre>
                        </div>
                    </div>
                </div>
            </div>

            <div class="title">公共模板 - include标签</div>
            <div class="content closed">
                <div class="list list-none">
                    <div class="content open ml-0">
                        <p>为了避免重复定义模板，可以把模板的公共头部和尾部分离出来，便于维护。</p>
                        <pre class="prettyprint linenums lang-html">
<code>
&lt;!--application/index/view/user/header.html-->
&lt;!doctype html>
&lt;html lang="en">
&lt;head>
&lt;meta charset="UTF-8">
&lt;title>查看用户列表&lt;/title>
&lt;link ref="stylesheet" href="common.css">
&lt;/head>
&lt;body>

</code>
						</pre>

                        <pre class="prettyprint linenums lang-html">
<code>
&lt;!--application/index/view/user/footer.html-->
&lt;div class="copyright">
    &lt;a title="官网" href="http://www.thinkphp.cn">ThinkPHP&lt;/a> 
    &lt;span>V5&lt;/span> 
    &lt;span>{ 十年磨一剑-为API开发设计的高性能框架 }&lt;/span>
&lt;/div>
&lt;/body>
&lt;/html>
</code>
						</pre>

                        <p>然后使用include标签, 套用公共模板文件.</p>
                        <pre class="prettyprint linenums lang-html">
<code>
&lt;!--application/index/view/user/index.html-->
｛include file="user/header" /｝

&lt;h2>用户列表（｛$count｝）&lt;/h2> 
｛volist name="list" id="user" ｝
    &lt;div class="info">
        ID：｛$user.id｝&lt;br/>
        昵称：｛$user.nickname｝&lt;br/>
        邮箱：｛$user.email｝&lt;br/>
    &lt;/div>
｛/volist｝

｛include file="user/footer" /｝
</code>
						</pre>

                    </div>

                    <div class="title">公共模板变量</div>
                    <div class="content open ml-0">
                        <p>公共模板文件中可能存在一些变量，例如这里的页面标题, 不同的页面会有不同，可以使用</p>
                        <pre class="prettyprint linenums">
<code>
｛include file="user/header" title="查看用户列表" /｝
</code>
						</pre>

                        <p>然后修改头部模板文件</p>
                        <pre class="prettyprint linenums">
<code>
&lt;title>[title]&lt;/title>
</code>
						</pre>

                        <p>如果需要传递多个变量，则使用多个属性即可，例如：</p>
                        <pre class="prettyprint linenums">
<code>
｛include file="user/header" title="查看用户列表" keywords="thinkphp" /｝
</code>
						</pre>

                        <p>也可以支持传递动态变量的方式，例如：</p>
                        <pre class="prettyprint linenums">
<code>
｛include file="user/header" title="$title" /｝
</code>
						</pre>
                    </div>
                </div>
            </div>

            <div class="title">模板布局 - layout标签</div>
            <div class="content closed">
                <div class="list list-number">
                    <div class="title">定义模板布局文件</div>
                    <div class="content open">
                        <pre class="prettyprint linenums">
<code>
&lt;!--application/index/view/layout.html-->
&#123;include file="user/header" /}
&#123;__CONTENT__}
&#123;include file="user/footer" /}
</code>
						</pre>
                    </div>

                    <div class="title">套用到某个模板文件: 使用Layout标签</div>
                    <div class="content closed">
                        <p>使用Layout标签套用模板布局文件</p>
                        <pre class="prettyprint linenums">
<code>
&lt;!--application/index/view/user/index.html-->
&#123;layout name="layout" /}    // 套用模板布局文件: /view/layout.html

&lt;h2>用户列表（&#123;$count}）&lt;/h2>    // 这里开始就是&#123;__CONTENT__}内容
&#123;volist name="list" id="user" }
    &lt;div class="info">
        ID：&#123;$user.id}&lt;br/>
        昵称：&#123;$user.nickname}&lt;br/>
        邮箱：&#123;$user.email}&lt;br/>
    &lt;/div>
&#123;/volist}
</code>
						</pre>

                        <p>如果你的布局模板中不是使用{__CONTENT__}的话，需要使用replace属性: </p>
                        <pre class="prettyprint linenums">
<code>
&#123;layout name="layout/newlayout" replace="[__REPLACE__]" /}
</code>
						</pre>
                    </div>

                    <div class="title">套用到所有模板文件: 使用全局模板布局</div>
                    <div class="content closed">
                        <p>如果所有的模板文件都使用同一个模板布局文件，那么可以统一配置而不需要在模板文件中使用layout标签定义。</p>
                        <p>在应用配置或者模块配置中添加如下设置参数：</p>
                        <pre class="prettyprint linenums">
<code>
'template' => [
     'layout_on' => true,    // 开启全局模板布局
     'layout_name' => 'layout',    // 使用模板布局文件: layout.html
     'layout_item' => '[__CONTENT__]'    // layout_item关键字
 ]
</code>
						</pre>
                        <p class="text-strong">如果使用配置方式开启了全局模板布局，也可以临时关闭，例如：</p>
                        <p>(1) 在控制器中使用layout()函数</p>
                        <pre class="prettyprint linenums">
<code>
// 获取用户数据列表
public function index()
{
    $list = UserModel::all();
    $this->assign('list', $list);
    $this->assign('count', count($list));
    $this->view->engine->layout(false);    // 临时关闭布局
    return $this->fetch();
}
</code>
						</pre>
                        <p>(2) 或者直接在模板文件的开头加上{__NOLAYOUT__}标签：</p>
                        <pre class="prettyprint linenums">
<code>
&#123;__NOLAYOUT__}
&lt;h2>用户列表（&#123;$count}）&lt;/h2>
&#123;volist name="list" id="user" mod="2" }
&lt;div class="info">
ID：&#123;$user.id}&lt;br/>
昵称：&#123;$user.nickname}&lt;br/>
邮箱：&#123;$user.email}&lt;br/>
生日：&#123;$user.birthday}&lt;br/>
&lt;/div>
&#123;/volist}
</code>
						</pre>
                    </div>

                    <div class="title">使用动态模板布局</div>
                    <div class="content closed">
                        <p>如果想动态控制模板文件使用布局，则可以在控制器中使用：</p>
                        <pre class="prettyprint linenums">
<code>
// 获取用户数据列表
public function index()
{
    $list = UserModel::all();
    $this->assign('list', $list);
    $this->assign('count', count($list));
    $this->view->engine->layout('layout','[__REPLACE__]');    // 动态使用布局
    return $this->fetch();
}
</code>
						</pre>
                    </div>
                </div>
            </div>

            <div class="title">模板继承: &#123block} & &#123extend}</div>
            <div class="content closed">
                <a href="https://www.kancloud.cn/manual/thinkphp5/125014">官方文档</a>
            </div>

            <div class="title">分页输出</div>
            <div class="content closed">
                <p>(1) 先将控制器index方法修改为：</p>
                <pre class="prettyprint linenums">
<code>
// 获取用户数据列表
public function index()
{
    // 分页输出列表 每页显示3条数据
    $list = UserModel::paginate(3);
    $this->assign('list',$list);
    return $this->fetch();
}
</code>
				</pre>
                <p>(2) 然后将视图文件修改为：</p>
                <pre class="prettyprint linenums">
<code>
&lt;h2>用户列表（&#123;$list->total()}&lt;/h2>
&#123;volist name="list" id="user"}
    ID：&#123;$user.id}&lt;br/>
    昵称：&#123;$user.nickname}&lt;br/>
    邮箱：&#123;$user.email}&lt;br/>
    ------------------------&lt;br/>
&#123;/volist}
&#123;$list->render()}    // render干什么用的???
</code>
				</pre>
            </div>

            <div class="title">输出替换</div>
            <div class="content closed">
                <p>可以在输出之前(输出到浏览器?)对解析后的内容进行替换，使用replace()函数：</p>
                <pre class="prettyprint linenums">
<code>
// 读取用户数据
public function read($id='')
{
    $user = UserModel::get($id);
    $this->assign('user',$user);
    $this->view->replace([
        '__PUBLIC__' => '/static',
    ]);
    return $this->fetch();
}
</code>
				</pre>
                <p>模板文件改为:</p>
                <pre class="prettyprint linenums">
<code>
&lt;html>
&lt;head>
&lt;meta charset="UTF-8">
&lt;title>[title]&lt;/title>
&lt;link charset="utf-8" rel="stylesheet" href="__PUBLIC__/common.css">    // 最终输出的时候，__PUBLIC__会自动替换为'/static'
&lt;/head>
&lt;body>
</code>
				</pre>
            </div>
        </div>
    </div>


</div>

{include file="php/tp5/template/footer" /}